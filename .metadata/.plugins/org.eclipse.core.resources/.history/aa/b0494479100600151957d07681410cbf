package action;

import model.JobDetail;
import model.UserAccount;

import org.apache.struts2.ServletActionContext;

import serviceImp.IJobDetailService;
import serviceImp.ILoginService;
import tool.ResultUtil;

public class SignInAction {

	private String jobid;
	private IJobDetailService jobDetailService;
	private String userid;
	private String mobile;
	private String pwd;
	private ILoginService loginService;

	public String getJobid() {
		return jobid;
	}

	public void setJobid(String jobid) {
		this.jobid = jobid;
	}

	public IJobDetailService getJobDetailService() {
		return jobDetailService;
	}

	public void setJobDetailService(IJobDetailService jobDetailService) {
		this.jobDetailService = jobDetailService;
	}

	public String execute() {

		UserAccount tmpAccount = new UserAccount();
		tmpAccount.setUserid(Long.parseLong(userid));
		tmpAccount.setMobile(mobile);
		tmpAccount.setPassword(pwd);

		String result = loginService.checkAccount(tmpAccount);

		if (result.equals("password wrong"))
			ResultUtil.returnJsonWithCode500(
					ServletActionContext.getResponse(), null, "密码错误！");
		else if (result.equals("mobile wrong"))
			ResultUtil.returnJsonWithCode500(
					ServletActionContext.getResponse(), null, "用户账号不存在！");
		else {
			
			JobDetail job = jobDetailService
					.getJobDetailById(Long.parseLong(jobid));
			String resultStr;
			if (job.getWorktimetype() == 1)
			{
				resultStr = jobDetailService.signLong(Long.parseLong(userid), Long.parseLong(jobid));
			}
			else
			{
				resultStr = jobDetailService.signShort(Long.parseLong(userid), Long.parseLong(jobid));
			}

			ResultUtil.returnJsonWithCode200(ServletActionContext.getResponse(),
					null, "取消学生报名成功！");
			
		}

		
		

		return null;
	}

}
